"use strict";var charts=document.getElementById("charts"),themeSwitch=document.getElementById("themeSwitch"),navHeight=60,borderPadding=5,chartPaddingBottom=20,chartPaddingTop=7,chartPolylineWidth=2,verticalLineWidth=2,chartLineWidth=1,chartNavLineWidth=1,chartCircleRaduus=5,dateItemWidth=150,minDistance=50,darkThemeStatus=!1,themes={dark:{gorizontal:"#384658",vertical:"#3b4a5a",text:"#657182",circle:"#242f3e"},light:{gorizontal:"#ecf0f3",vertical:"#dfe6eb",text:"#96a2aa",circle:"#ffffff"}},currentTheme=themes.light,createAnimate=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","animate");return n.setAttribute("attributeName","points"),n.setAttribute("attributeType","XML"),n.setAttribute("dur",".5s"),n.setAttribute("from",t),n.setAttribute("to",e),n.setAttribute("repeatCount","1"),n},createPolyline=function(t,e,n,r){var a=document.createElementNS("http://www.w3.org/2000/svg","polyline");return a.setAttribute("fill","none"),a.style.stroke=t,a.style.strokeWidth=e,a.setAttribute("id",n),a.setAttribute("points",r),a.setAttribute("pathLength",1e3),a},createCircle=function(t,e,n,r,a){var c=document.createElementNS("http://www.w3.org/2000/svg","circle");return c.setAttribute("fill",currentTheme.circle),c.setAttribute("cx",t),c.setAttribute("cy",e),c.setAttribute("r",n),c.style.stroke=r,c.style.strokeWidth=a,c},createLine=function(t,e,n,r,a){var c=document.createElementNS("http://www.w3.org/2000/svg","line");return c.setAttribute("x1",t),c.setAttribute("y1",e),c.setAttribute("x2",n),c.setAttribute("y2",r),c.setAttribute("class",a),c.style.stroke=currentTheme.gorizontal,c.style.strokeWidth=chartLineWidth,c},createText=function(t,e,n,r){var a=document.createElementNS("http://www.w3.org/2000/svg","text");return a.setAttribute("x",t),a.setAttribute("class",r),a.setAttribute("y",e),a.setAttribute("fill",currentTheme.text),a.innerHTML=n,a},toggleTheme=function(){document.body.classList.toggle("dark"),currentTheme=(darkThemeStatus=!darkThemeStatus)?themes.dark:themes.light,themeSwitch.innerHTML="Switch to ".concat(darkThemeStatus?"Day":"Night"," Mode");var t=document.getElementsByClassName("gorizontal"),e=!0,n=!1,r=void 0;try{for(var a,c=t[Symbol.iterator]();!(e=(a=c.next()).done);e=!0){a.value.style.stroke=currentTheme.gorizontal}}catch(t){n=!0,r=t}finally{try{e||null==c.return||c.return()}finally{if(n)throw r}}var i=document.getElementsByClassName("value"),o=!0,s=!1,u=void 0;try{for(var d,l=i[Symbol.iterator]();!(o=(d=l.next()).done);o=!0){d.value.setAttribute("fill",currentTheme.text)}}catch(t){s=!0,u=t}finally{try{o||null==l.return||l.return()}finally{if(s)throw u}}var v=document.getElementsByClassName("vertical"),m=!0,h=!1,f=void 0;try{for(var g,p=v[Symbol.iterator]();!(m=(g=p.next()).done);m=!0){g.value.style.stroke=currentTheme.vertical}}catch(t){h=!0,f=t}finally{try{m||null==p.return||p.return()}finally{if(h)throw f}}};data.forEach(function(v,m){var t=document.createElement("div");t.className="chartBlock";var e=document.createElement("div");e.className="chart";var h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.classList.add("chartSvg");var a=document.createElementNS("http://www.w3.org/2000/svg","line");a.classList.add("vertical");var n=document.createElement("div");n.className="nav";var r=document.createElement("div");r.className="navLeft";var c=document.createElement("div");c.className="navRight";var f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.classList.add("navSvg");var i=document.createElement("div");i.className="legend";var o=document.createElement("div");o.className="modal";var s=document.createElement("div");s.className="modalDate";var u=document.createElement("div");u.className="modalLegend",h.append(a),o.append(s,u),e.append(h,o),n.append(f,r,c),t.append(e,n,i),charts.append(t);var g=n.offsetWidth,p=e.offsetHeight,y=.5*g,b=.9*g,d=0,l="center",E=0,L=null,A=[],w={},T={x:0,value:0},x=[],S={},P=0,N=0,k=0;a.style.stroke=currentTheme.vertical,a.style.strokeWidth=verticalLineWidth,v.show={},v.points={},v.navPoints={};var B={};v.columns.forEach(function(t){var e=t.splice(0,1);B[e]=t,v.show[e]=!0});var I=B.x;delete B.x;var W=function(t){var e=t.pageX-n.offsetLeft;"left"===l?y+=e-d:"right"===l?b-=d-e:(0<y&&(b-=d-e),b<g&&(y+=e-d)),y<0&&(y=0),g<b&&(b=g),"right"===l&&b<y+2*borderPadding&&(b=y+2*borderPadding),"left"===l&&b-2*borderPadding<y&&(y=b-2*borderPadding),O(),j(),X(),F(),d=e},M=function(t){d=t.pageX-n.offsetLeft,l="center",d<y+borderPadding?l="left":b-borderPadding<d&&(l="right")},H=function(t,e){var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],r=new Date(t);return"withDay"===e?"".concat(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][r.getDay()],", ").concat(n[r.getMonth()]," ").concat(r.getDate()):"".concat(n[r.getMonth()]," ").concat(r.getDate())},D=function(t,e,n,r,a){return"".concat(e,",").concat(r?"":"-").concat(a)},z=function(){h.querySelectorAll("circle").forEach(function(t){t.remove()})},C=function(t){if(t.target===h){z();var n=t.offsetX,c=-1;if(x.forEach(function(t,e){k*e<n&&k*(e+1)<n||n<k*e&&n<k*(e+1)||(c=k*(e+1)-n<n-k*e?e+1:e)}),-1!==c){a.setAttribute("x1",n),a.setAttribute("x2",n),a.setAttribute("y1",0),a.setAttribute("y2",p-chartPaddingBottom+4);u.innerHTML="",Object.keys(B).forEach(function(t){if(v.show[t]){var e=createCircle(x[c],S[t][c],chartCircleRaduus,v.colors[t],chartPolylineWidth);h.append(e);var n=document.createElement("div"),r=document.createElement("b"),a=document.createElement("span");r.innerHTML=w[t][c],a.innerHTML=v.names[t],n.append(r),n.append(a),n.setAttribute("style","color: ".concat(v.colors[t])),u.append(n)}});var e=o.offsetWidth||100,r=x[c]+e+10>g?x[c]-e-10:x[c]+10;s.innerHTML=H(A[c],"withDay"),o.setAttribute("style","top: 0px; left: ".concat(r,"px")),o.classList.add("active")}}},q=function(t){t.target===h&&(a.setAttribute("x1",0),a.setAttribute("x2",0),a.setAttribute("y1",0),a.setAttribute("y2",0),z(),o.classList.remove("active"))},O=function(){return r.style.width=y+"px"},j=function(){return c.style.width=g-b+"px"},X=function(s,u){P=1/0;N=0;var d=parseInt(I.length*y/g,10),l=parseInt(I.length*b/g,10);A=I.slice(d,l);var e=-(k=g/(A.length-1));x=A.map(function(t){return e+=k}),Object.keys(B).forEach(function(r){if(v.show[r]){var a="",t=B[r].slice(d,l);t.forEach(function(t){t<P&&(P=t),N<t&&(N=t)}),S[r]=[],w[r]=t;var c=(p-chartPaddingBottom)/N;if(t.forEach(function(t,e){var n=p-c*t-chartPaddingBottom+chartPaddingTop;S[r].push(n),a+="".concat(x[e],",").concat(n," ")}),s){var e=createPolyline(v.colors[r],chartPolylineWidth,"chart-svg-".concat(m,"-").concat(r),a);h.append(e)}else{var n=document.getElementById("chart-svg-".concat(m,"-").concat(r));n.innerHTML="";var i=v.points[r];if(u){var o=createAnimate(i,a);n.append(o),o.beginElement()}n.setAttribute("points",a)}v.points[r]=a}}),L&&clearTimeout(L),L=setTimeout(function(){return J()},300)},J=function(){var t=parseInt(.9*p/minDistance,10);5<t&&(t=5);var a=0<t?parseInt(.9*p/t,10):0,c=parseInt((N-(0<P?0:P))/minDistance,10);if(E!==N){if(E=N,h.querySelectorAll(".value").forEach(function(t){t.classList.remove("active"),t.classList.add("remove"),setTimeout(function(){return t.remove()},1e3)}),h.querySelectorAll(".gorizontal").forEach(function(t){t.classList.remove("active"),t.classList.add("remove"),setTimeout(function(){return t.remove()},1e3)}),!c||!a){var e=createLine(0,p-chartPaddingBottom+4,g,p-chartPaddingBottom+4,"gorizontal");return h.prepend(e),void e.classList.add("active")}for(var n=t<5?t:6,r=function(t){var e=p-t*a,n=createLine(0,e-chartPaddingBottom+4,g,e-chartPaddingBottom+4,"gorizontal");h.prepend(n),setTimeout(function(){return n.classList.add("active")},200);var r=createText(0,e-4-chartPaddingBottom,t*c,"value");h.prepend(r),setTimeout(function(){return r.classList.add("active")},200)},i=0;i<n;i++)r(i)}},R=function(c){var i=1/0,o=0,e=g/(I.length-1),n=-e,s=I.map(function(t){return n+=e});Object.keys(B).forEach(function(t){var n="";B[t].forEach(function(t,e){t<i&&(i=t),o<t&&(o=t)});var r=navHeight/o;if(B[t].forEach(function(t,e){n+="".concat(s[e],",").concat(navHeight-r*(t-i)," ")}),c){var e=createPolyline(v.colors[t],chartNavLineWidth,"nav-svg-".concat(m,"-").concat(t),n);f.append(e)}else{var a=document.getElementById("nav-svg-".concat(m,"-").concat(t));a&&a.setAttribute("points",n)}v.navPoints[t]=n})},F=function(t){var e=A.length;if(0!==e){h.querySelectorAll(".date").forEach(function(t){return t.remove()});var n=dateItemWidth,r=parseInt(g/n,10);e<r&&(r=e,n=parseInt(g/r,10));var a=parseInt(e/r,10),c=A.findIndex(function(t){return t===T.value});-1===c?(T.x=0,T.value=A[0],c=0):T.x=x[c];var i=[T];if(0<a){for(var o=c-a;0<=o;o-=a)i.unshift({x:x[o],value:A[o]});for(var s=c+a;s<e;s+=a)i.push({x:x[s],value:A[s]})}T=i[parseInt(i.length/2,10)],i.forEach(function(t){var e=createText(t.x,p-2,H(t.value),"date");e.setAttribute("style","font-size: 12px;"),h.append(e)})}};O(),j(),X(!0),R(!0),F(!0),Object.keys(B).forEach(function(t){var e=document.createElement("div");e.setAttribute("id","legend-item-".concat(m,"-").concat(t)),e.classList.add("legendItem","active");var n=document.createElement("div");n.style.background=v.colors[t],e.append(n),e.innerHTML+="<span>".concat(v.names[t],"</span>"),i.append(e)}),n.addEventListener("mousedown",function(t){M(t);document.addEventListener("mousemove",W),document.addEventListener("mouseup",function t(){document.removeEventListener("mousemove",W),document.removeEventListener("mouseup",t)})}),n.addEventListener("touchstart",function(t){M(t);document.addEventListener("touchmove",W),document.addEventListener("touchend",function t(){document.removeEventListener("touchmove",W),document.removeEventListener("touchend",t)})}),h.addEventListener("mousemove",C),h.addEventListener("mouseleave",q),h.addEventListener("touchstart",C),h.addEventListener("touchend",q),i.addEventListener("click",function(t){var e="";if(t.target.getAttribute("id")?(e=t.target.getAttribute("id"),t.target.classList.toggle("active")):(e=t.target.parentNode.getAttribute("id"),t.target.parentNode.classList.toggle("active")),e){var n=/^legend-item-(.+)-(.+)$/gi.exec(e)[2];v.show[n]=!v.show[n];var r=/(\d+(\.\d+)?),(\-)?(\d+(\.\d+)?)/gi,a=f.getElementById("nav-svg-".concat(m,"-").concat(n));if(a){a.innerHTML="";var c=v.navPoints[n],i=c.replace(r,D),o=createAnimate(c,i);a.append(o),o.beginElement(),setTimeout(function(){return a.setAttribute("points",i)},500),v.navPoints[n]=i}var s=h.getElementById("chart-svg-".concat(m,"-").concat(n));if(s){s.innerHTML="";var u=v.points[n],d=u.replace(r,D),l=createAnimate(u,d);s.append(l),l.beginElement(),setTimeout(function(){return s.setAttribute("points",d)},500),v.points[n]=d}setTimeout(function(){return X(!1,!0)},500)}}),window.addEventListener("resize",function(){var t=n.offsetWidth;y=t*y/g,b=t*b/g,g=t,p!==e.offsetHeight&&(E=0),p=e.offsetHeight,O(),j(),R(),X(),F(),h.querySelectorAll(".gorizontal").forEach(function(t){t.setAttribute("x2",g)})})});